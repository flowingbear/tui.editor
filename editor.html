<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>TOAST UI Editor by FE Development Lab / NHN Entertainment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- OpenGraph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="TOAST UI Editor" />
    <meta property="og:description" content="GFM Markdown Wysiwyg Editor - Productive and Extensible" />
    <meta property="og:image" content="https://user-images.githubusercontent.com/1215767/34353629-95b58da0-ea6c-11e7-859b-df5e990dd157.png" />
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" href="bower_components/tui-color-picker/dist/tui-color-picker.css">
    <link rel="stylesheet" href="bower_components/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="bower_components/highlightjs/styles/github.css">
    <link rel="stylesheet" href="bower_components/tui-chart/dist/tui-chart.min.css">
    <link rel="stylesheet" href="bower_components/tui-editor/dist/tui-editor.min.css">
    <link rel="stylesheet" href="bower_components/tui-editor/dist/tui-editor-contents.min.css">
    <script src="bower_components/markdown-it/dist/markdown-it.min.js"></script>
    <script src="bower_components/toMark/dist/toMark.min.js"></script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/tui-code-snippet/dist/tui-code-snippet.min.js"></script>
    <script src="bower_components/tui-color-picker/dist/tui-color-picker.min.js"></script>
    <script src="bower_components/codemirror/lib/codemirror.js"></script>
    <script src="bower_components/highlightjs/highlight.pack.min.js"></script>
    <script src="bower_components/squire-rte/build/squire.js"></script>
    <script src="bower_components/plantuml-encoder/dist/plantuml-encoder.min.js"></script>
    <script src="bower_components/raphael/raphael.min.js"></script>
    <script src="bower_components/tui-chart/dist/tui-chart.min.js"></script>
    <script src="bower_components/tui-editor/dist/tui-editor-Editor-all.min.js"></script>
    <style>
     #editSection, #editSection *,
     .tui-editor-contents *,
     .CodeMirror pre {
         font-family: Roboto, -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", "Oxygen", "Ubuntu", "Cantarell", "Open Sans", sans-serif;
     }

     #editSection button,
     #editSection input,
     #editSection .te-editor {
         font-size: 12px;
     }

     #editSection h1,
     #editSection h2,
     #editSection h3,
     #editSection h4,
     #editSection h5,
     #editSection h6 {
         color: #222;
         font-weight: 300;
     }

     #editSection .tui-popup-body h1 {
         font-size: 28px;
         color: black;
     }

     #editSection h1:first-of-type {
         margin-top: 14px;
     }

     #editSection .tui-popup-body h2 {
         font-size: 24px;
         border-bottom: 1px solid #cccccc;
         color: black;
     }

     #editSection .tui-popup-body h3 {
         font-size: 18px;
     }

     #editSection .tui-popup-body h4 {
         font-size: 16px;
     }

     #editSection .tui-popup-body h5 {
         font-size: 14px;
     }

     #editSection .tui-popup-body h6 {
         color: #777777;
         font-size: 14px;
     }

     button {
         font-size: 12px
     }

     .show-toolbar .tui-editor-defaultUI {
         border: 1px solid #e5e5e5
     }

     .tui-editor-defaultUI {
         margin: 15px 0;
     }

     .te-md-container,
     .te-ww-container {
         width: 100%
     }

     .te-md-container .CodeMirror,
     .tui-editor-contents {
         font-size: 20px;
     }

     .show-only-text .te-toolbar-section,
     .show-only-text .te-mode-switch-section,
     .show-only-text .te-markdown-tab-section {
         visibility: hidden !important;
         opacity: 0;
         transition: visibility 0s linear 300ms, opacity 300ms;
     }

     .show-only-text:hover .te-toolbar-section,
     .show-only-text:hover .te-mode-switch-section,
     .show-only-text:hover .te-markdown-tab-section {
         visibility: visible !important;
         opacity: 1;
         transition: visibility 0s linear 0ms, opacity 300ms;
     }

     .show-only-text .tui-editor-defaultUI {
         border: 1px solid rgba(255, 255, 255, 0);
         transition: border-color 0s linear 300ms, border-color 300ms;
     }

     .show-only-text:hover .tui-editor-defaultUI {
         border: 1px solid #e5e5e5;
         transition: border-color 0s linear 0ms, border-color 300ms;
     }

     .tui-editor-contents,
     .CodeMirror {
         color: #606c71;
     }

     .tui-editor-contents .task-list-item {
         background-position: 0 5px;
     }

     .te-md-container .te-preview {
         overflow-x: hidden;
         overflow-y: auto;
     }

     .CodeMirror .cm-header {
         font-weight: 300;
     }

     b, strong, .cm-strong {
         font-weight: 400;
     }

     .site-footer {
         text-align:center;
     }

    </style>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Config Editor</h1>
      <h2 class="project-tagline">Combine markdown as explanation and code block as config values</h2>
      <a href="api/latest/" class="btn" target="_blank" style="margin-left:5px">API</a>
    </section>

    <section class="main-content">
	  <button class="fn-preview">Preview</button>
	  <button class="fn-download">Export</button>
	  <div id="editor" class="show-only-text"></div>
	  <div id="viewer" class="show-only-text"></div>
	  <button class="fn-preview">Preview</button>
      <button class="fn-download">Export</button>
      
      <footer class="site-footer">
          <a>WD site info </a>
      </footer>
    </section>
    <script>
	function isEmpty(value){
		return (typeof value === "undefined" || value === null);
	}

	
	  function extractJson(text) {
		if (isEmpty(text))
			return '';
		var startAt0 =  text.indexOf("\`\`\`") == 0;
		var matches= text.split(/\`\`\`/g);
		console.log('matches = ' , matches);
		if (matches.length < 3 )
			return '';
		if ( startAt0  && matches.length <2)
			return '';
		var i =startAt0 ? 0 : 1;
		
		var json= [];
		while (i < matches.length) {
			json = json 
				? $.merge( json, parseCodeBlock(matches[i]))
				: parseCodeBlock(matches[i]);
			i+=2;
		}
		console.log('json = ' , json);
		return json;
	  }
	  function mkJson(a,b) {
		return a.replace("?", "{\"" + b + "\":?}");
	  }
	  
	  function parseCodeBlock(jsCodeBlock) {
		if (jsCodeBlock.startsWith('js')) {
			var block = jsCodeBlock.substr(2).trim();
			console.log('block = ', block);
			pos = block.indexOf('\n');
			var jsonStr = block.substr(pos+1).replace('\n','');
			var path = block.substr(0,pos).split('.');
			//path.push(jsonStr);
			console.log('path', path);
			var fullJson = path.reduce( mkJson , "?" ).replace("?", jsonStr);
			
			console.log('fullJson', fullJson);
			var obj = JSON.parse(fullJson);
			console.log('sub obj = ', obj);
			return obj;
		}
		
	  }
	  
	  $('#editor').tuiEditor({
          height: 'auto',
        initialEditType: 'markdown',
        previewStyle: 'vertical',
        initialValue: 'config 1\n```js hk\n{"a" : "b" }\n```\nconfig 2\n```js hk.wanchai\n {"c":"d"}\n```\n'
      });
	  

      $(document).on('click', function(e) {
          if ($(e.target).parents('.show-only-text').length === 0) {
              $('.show-only-text').removeClass('show-toolbar');
          }
      });
	  
	  $("[class='fn-preview']").on('click', function(e) {
			var text=$('#editor').data('tuiEditor').getMarkdown();
			var result = extractJson(text);
			$('#viewer').tuiEditor({
				height: '300px',
				viewer: true,
				initialValue: result
			  });
	  });
	  
	  $("[class='fn-download']").on('click', function(e) {
			var text=$('#editor').data('tuiEditor').getMarkdown();
			
			/*var filename='export.json';
			var pom = document.createElement('a');
			pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
			pom.setAttribute('download', filename);
	  
			if (document.createEvent) {
				var event = document.createEvent('MouseEvents');
				event.initEvent('click', true, true);
				pom.dispatchEvent(event);
			}
			else {
				pom.click();
			}*/
	  });

    </script>

    <!-- Github -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>
